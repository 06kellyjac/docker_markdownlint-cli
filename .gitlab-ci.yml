---
stages:
  - lint
  - poll


.env_entrypoint:
  image:
    name: _ # Placeholder to keep YAML schemea happy
    entrypoint: &env_entrypoint
      - "/usr/bin/env"
      - "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"


lint:shell:
  stage: lint
  image: docker
  services:
    - docker:dind
  before_script:
    - docker --version
  script:
    - LIST_OF_SHELL=$(find -path '.git' -prune -o -print | egrep "\.sh$")
    - docker run -v "$PWD:/mnt" koalaman/shellcheck $LIST_OF_SHELL
  except:
    - schedules

lint:yaml:
  stage: lint
  image: sdesbure/yamllint
  before_script:
    - yamllint --version
  script:
    - yamllint --strict --config-file .yamllint.yaml .
  except:
    - schedules

# Common markdown config
.markdown: &markdown
  stage: lint
  before_script:
    - markdownlint --version
  script:
    - markdownlint .
  except:
    - schedules

lint:markdown:docker_hub:
  image:
    name: 06kellyjac/markdownlint-cli
    entrypoint: *env_entrypoint
  <<: *markdown

lint:markdown:gitlab:
  image:
    name: registry.gitlab.com/06kellyjac/docker_markdownlint-cli
    entrypoint: *env_entrypoint
  <<: *markdown


poll:npm:
  stage: poll
  image: node:alpine
  before_script:
    - node --version
    - npm --version
  script:
    - .scripts/poll_npm_version.sh
  only:
    - schedules
    - web

poll:docker_hub:
  stage: poll
  image: alpine
  script:
    - .scripts/poll_node_docker_hub.sh
  only:
    - schedules
    - web
